$color-bg: #4f8edb;
$color-primary: rgba(#30508f, 0.3);
$color-primary: #30508f;
$color-white: rgba(white, 0.3);
$color-white: white;

$color-light: #9eb6d7;
$color-lighter: #c8daf2;
$color-dark: #343c60;

$color-ear: #de6465;
$color-tongue: $color-ear;

$duration: 12s;
$total-kf: 15;

$k-head: (
  0: rotate(0),
  1: rotate(0),
  3: rotate(-14deg),
  6: rotate(-7deg),
  7: rotate(-14deg),
  9: rotate(-7deg),
  11: rotate(0),
  12: rotate(0),
);

$k-mouth: (
  0: translateX(0),
  1: translateX(0),
  2: translateX(35%),
  3: translateX(35%),
  4: translateX(35%),
  5: translateX(0) translateY(-5%),
);

$k-nose: (
  0: translate(0),
  1: translate(0),
  2: translateX(100%),
  4: translateX(100%),
  5: translateX(0) translateY(-15%),
);

$k-body: (
  0: translate(0),
  1: translateY(3%),
  2: translate(0),
  3: translate(0),
  4: translateY(2%),
  5: translateY(0),
);

$k-mane: map-merge(
  $k-body,
  (
    1: translateY(5%),
    4: translateY(3%),
  )
);

$k-face: (
  0: translate(0),
  1: translate(0),
  2: translateX(15%),
  3: translateX(15%) translateY(0),
  4: translateX(15%) translateY(0),
  5: translateX(0) translateY(-15%),
  6: translateX(0) translateY(-15%),
  7: translateX(0) translateY(0),
);

$k-left-eye: (
  0.4: scaleY(1),
  0.5: scaleY(0.3),
  0.6: scaleY(1),
  1: translateX(0),
  1.4: scaleY(1) translateX(75%),
  1.5: scaleY(0.3) translateX(75%),
  1.6: scaleY(1) translateX(75%),
  2: translateX(150%),
  3.3: scaleY(1) translateX(150%),
  3.4: scaleY(0.3) translateX(150%),
  3.5: scaleY(1) translateX(150%),
  3.8: scaleY(1) translateX(150%),
  3.9: scaleY(0.3) translateX(150%),
  4: scaleY(1) translateX(150%),
  5: translateX(0) translateY(-170%),
  5.4: scaleY(1) translateY(-170%),
  5.5: scaleY(0.3) translateY(-170%),
  5.6: scaleY(1) translateY(-170%),
  5.7: scaleY(1) translateY(-170%),
  5.8: scaleY(0.3) translateY(-170%),
  5.9: scaleY(1) translateY(-170%),
  8: translateY(0),
  9.8: scaleY(1) translateY(0),
  9.9: scaleY(0.3) translateY(0),
  10: scaleY(1) translateY(0),
  10.5: scaleY(1) translateY(0),
  10.6: scaleY(0.3) translateY(0),
  10.7: scaleY(1) translateY(0),
);

$k-right-eye: $k-left-eye;

$k-tongue: (
  7: translateY(0),
  8: translateY(100%) rotate(10deg),
  11: translateY(100%) rotate(10deg),
  12: translateY(0),
);

$k-mouth-cover-left: (
  6: rotate(0),
  9: rotate(90deg),
  11: rotate(90deg),
  13: rotate(0),
);

$k-mouth-cover-right: (
  6: rotate(0),
  9: rotate(-90deg),
  11: rotate(-90deg),
  13: rotate(0),
);

$k-tail: (
  1: rotate(0),
  1.5: rotate(30deg),
  2: rotate(0),
  3: rotate(0),
  4: rotate(30deg),
  7: rotate(30deg),
  7.25: rotate(0),
);
$tail-wags: 14;
$tail-interval: (11 - 7.5) / $tail-wags;
@for $i from 1 through $tail-wags {
  $k-tail: map-merge(
    $k-tail,
    (
      (
        ($i - 1) * $tail-interval + 7.5,
      ):
      rotate(28deg),
      (
        ($i - 0.5) * $tail-interval + 7.5,
      ):
      rotate(0),
    )
  ) !global;
}

$k-left-ear: (
  0: rotate(6deg),
  1: rotate(6deg),
  2: rotate(15deg),
  4: rotate(15deg),
  5: rotate(30deg),
  6: rotate(30deg),
  7: rotate(0deg),
  8: rotate(0deg),
  9: rotate(15deg),
  12: rotate(15deg),
  14: rotate(6deg),
  $total-kf: rotateZ(6deg),
);

$k-right-ear: (
  0: rotateZ(-16deg),
  1: rotateZ(-16deg),
  2: rotateZ(-19deg),
  4: rotateZ(-19deg),
  5: rotateZ(-30deg),
  5.5: rotateZ(-19deg),
  5.6: rotateZ(-30deg),
  5.7: rotateZ(-19deg),
  6: rotateZ(-19deg),
  6.1: rotateZ(-30deg),
  6.2: rotateZ(-19deg),
  7: rotateZ(-9deg),
  8: rotateZ(-9deg),
  9: rotateZ(-19deg),
  9.1: rotateZ(-30deg),
  9.2: rotateZ(-19deg),
  9.4: rotateZ(-19deg),
  9.5: rotateZ(-30deg),
  9.6: rotateZ(-19deg),
  12: rotateZ(-19deg),
  14: rotateZ(-16deg),
  $total-kf: rotateZ(-16deg),
);

@each $i, $prop in $k-right-ear {
  $k-right-ear: map-merge(
    $k-right-ear,
    (
      $i: $prop + ' ' + rotateY(180deg),
    )
  );
}

@mixin effect($name, $kf) {
  @keyframes #{$name} {
    @each $interval, $transform in $kf {
      #{percentage($interval/$total-kf)} {
        transform: $transform;
      }
    }
  }
}

@include effect('head', $k-head);
@include effect('mouth', $k-mouth);
@include effect('nose', $k-nose);
@include effect('body', $k-body);
@include effect('mane', $k-mane);
@include effect('face', $k-face);
@include effect('left-eye', $k-left-eye);
@include effect('right-eye', $k-right-eye);
@include effect('tongue', $k-tongue);
@include effect('mouth-cover-left', $k-mouth-cover-left);
@include effect('mouth-cover-right', $k-mouth-cover-right);
@include effect('tail', $k-tail);
@include effect('left-ear', $k-left-ear);
@include effect('right-ear', $k-right-ear);

*,
*:before,
*:after {
  animation-timing-function: cubic-bezier(0.645, 0.045, 0.355, 1) !important;
}

.husky {
  height: 60vmin;
  width: 84vmin;

  animation: squiggly-anim 0.3s infinite;

  @media screen and (max-width: 400px) {
    // Chrome for Android chokes
    animation: none;ChromeforAndroidchokesanimation
  }

  &:before {
    z-index: 2;
    top: 100%;
    left: 5%;

    height: 0.5vmin;
    width: 90%;

    border-radius: 0.5vmin;
    background: $color-primary;
  }

  &:after {
    z-index: 3;
    top: calc(100% + 0.5vmin);

    height: 10%;
    width: 100%;

    background: $color-bg;
  }
}

div:before,
div:after {
  position: absolute;

  display: block;

  content: '';
}

.head {
  position: absolute;
  top: 5%;
  left: 34%;

  height: 45%;
  width: 58%;

  transform-origin: bottom center;
  animation: head $duration none infinite;

  &:before {
    height: 100%;
    width: 100%;

    border-top-left-radius: 50% 40%;
    border-top-right-radius: 50% 40%;
    border-bottom-right-radius: 10% 60%;
    background: $color-primary;
  }
}

.face {
  position: absolute;
  top: 15%;
  left: 2%;

  height: 62%;
  width: 98%;

  animation: face $duration none infinite;

  &:before {
    z-index: 1;
    bottom: 5%;
    left: 3%;

    height: 70%;
    width: 94%;

    border-top-left-radius: 40% 50%;
    border-top-right-radius: 40% 50%;
    border-bottom-right-radius: 30% 40%;
    border-bottom-left-radius: 30% 50%;
    background-color: $color-white;
  }
}

.eye {
  position: absolute;
  z-index: 2;
  right: 45%;

  height: 40%;
  width: 30%;

  animation: eyes $duration none infinite;

  border-top-left-radius: 55% 50%;
  border-top-right-radius: 45% 50%;
  background-color: $color-white;

  &:before {
    top: 45%;
    left: 45%;

    height: 15%;
    width: 15%;

    transform-origin: center center;
    animation: left-eye $duration none infinite;

    border-radius: 100%;
    background: $color-dark;
  }

  + .eye {
    z-index: 1;
    right: initial;
    left: 48%;

    border-top-left-radius: 45% 50%;
    border-top-right-radius: 55% 50%;
  }
}

.nose {
  position: absolute;
  z-index: 2;
  top: 29%;
  left: 42%;

  height: 20%;
  width: 20%;

  animation: nose $duration none infinite;

  &:after {
    height: 100%;
    width: 100%;

    border-top-left-radius: 20% 20%;
    border-top-right-radius: 30% 20%;
    border-bottom-right-radius: 55% 80%;
    border-bottom-left-radius: 50% 80%;
    background: $color-primary;
  }

  &:before {
    z-index: -1;
    top: 50%;
    left: -50%;

    height: 100%;
    width: 200%;

    border-radius: 50%;
    background: $color-white;
  }
}

.ear {
  position: absolute;
  top: 3%;
  left: -10%;

  overflow: hidden;

  height: 30%;
  width: 48%;

  transform-origin: 80% center;
  animation: left-ear $duration both infinite;

  border-top-left-radius: 10%;
  border-bottom-left-radius: 100% 90%;
  background: $color-primary;

  &:before {
    top: 20%;
    left: 15%;

    height: 55%;
    width: 70%;

    transform: skewX(30deg) rotate(-5deg);
    transform-origin: top left;

    border: 2px solid $color-primary;
    background: $color-ear;
  }

  &:after {
    left: 32%;

    height: 100%;
    width: 70%;

    transform: rotate(-5deg);
    transform-origin: top left;

    border-top-left-radius: 100%;
    background: $color-primary;
  }

  + .ear {
    z-index: -1;
    top: 5%;
    left: 15%;

    transform-origin: right center;
    animation: right-ear $duration both infinite;

    background-color: $color-dark;

    &:before {
      border-color: $color-dark;
    }

    &:after {
      background: $color-dark;
    }
  }
}

.mouth {
  position: absolute;
  z-index: 1;
  bottom: -5%;
  left: 28%;

  overflow: hidden;

  height: 55%;
  width: 48%;

  animation: mouth $duration none infinite;

  &:before,
  &:after {
    z-index: 3;
    top: -50%;
    left: 0;

    height: 100%;
    width: 28%;

    transform-origin: right top;
    animation: mouth-cover-left $duration none infinite;

    background: $color-white;
  }

  &:after {
    right: 0;
    left: initial;

    transform-origin: left top;
    animation: mouth-cover-right $duration none infinite;
  }
}

.lips {
  z-index: 2;

  height: 35%;
  width: 100%;

  &:before,
  &:after {
    height: 100%;
    width: calc(50% + 1.5px);

    border-width: 3px;
    border-style: solid;
    border-color: $color-light;
    border-top-color: transparent;border-right-width
    border-right-color: transparent;
    border-top-right-radius: 50%;
    border-bottom-right-radius: 35% 50%;
    border-bottom-left-radius: 65% 100%;
    background: $color-white;
    // border-right-width: 0;
  }

  &:after {
    right: 0;
    left: initial;

    transform: rotateY(180deg);
  }
}

.tongue {
  position: absolute;
  z-index: 1;
  bottom: 100%;
  left: 25%;

  height: 100%;
  width: 44%;

  animation: tongue $duration none infinite;

  border-bottom-right-radius: 50% 20%;
  border-bottom-left-radius: 50% 20%;
  background: $color-tongue;
}

.body {
  position: absolute;
  left: 25%;

  height: 100%;
  width: 45%;

  animation: body $duration none infinite;
}

.torso {
  position: absolute;
  bottom: 0;

  height: 55%;
  width: 100%;

  &:before {
    height: 100%;
    width: 50%;

    transform: translateX(-20%) skewX(-30deg);
    transform-origin: left bottom;

    border-radius: 0 30% 0 60%;
    background: $color-primary;
  }

  &:after {
    top: 0;
    right: 0;

    height: 100%;
    width: 60%;

    border-radius: 10% 40% 60% 0;
    background: $color-primary;
  }
}

.mane {
  position: absolute;
  z-index: 2;
  top: 44%;
  left: 37%;

  height: 30%;
  width: 31.5%;

  animation: mane $duration none infinite;

  &:before {
    height: 40%;
    width: 100%;

    border-top-left-radius: 10% 50%;
    border-top-right-radius: 20% 100%;
    border-bottom-left-radius: 10% 50%;
    background: $color-white;
  }

  &:after {
    top: 25%;
    right: 23%;

    height: 76%;
    width: 30%;

    transform: rotate(47deg);
    transform-origin: bottom right;

    border-top-right-radius: 100% 80%;
    background: $color-white;
  }
}

.coat {
  position: absolute;
  top: 21%;
  left: 10%;

  height: 50%;
  width: 50%;

  transform: rotate(25deg) skewX(-30deg);
  transform-origin: bottom right;

  background: $color-white;
}

.legs {
  position: absolute;
  z-index: 1;
  bottom: 0;
  left: 23%;

  height: 30%;
  width: 42%;

  border-top-left-radius: 20% 37%;
  border-top-right-radius: 50%;
  border-bottom-left-radius: 10% 37%;
  background-color: $color-primary;
}

.front-legs {
  position: absolute;
  right: -12%;
  bottom: 0;

  height: 117%;
  width: 55%;

  &:before {
    z-index: 2;
    bottom: 0;
    left: 47%;

    height: 6%;
    width: 4%;

    background: transparent;
    box-shadow: -1.3vmin 0 0 $color-light, -2.8vmin 0 0 $color-light,
      1.3vmin 0 0 $color-bg, 2.8vmin 0 0 $color-bg;
  }

  > .leg {
    position: absolute;
    right: 50%;
    bottom: 0;

    overflow: hidden;

    height: 100%;
    width: 51%;

    &:before {
      height: 100%;
      width: 100%;

      transform: skewY(-30deg) skewX(10deg);
      transform-origin: top right;

      background: $color-lighter;
    }

    + .leg {
      right: 0;

      transform: rotateY(180deg);

      &:before {
        background: $color-light;
      }
    }
  }
}

.hind-leg {
  position: absolute;
  right: 45%;
  bottom: 0%;

  height: 25%;
  width: 35%;

  border-top-left-radius: 35% 100%;
  border-top-right-radius: 40% 100%;
  background: $color-light;

  &:before {
    bottom: 0;
    left: 70%;

    height: 20%;
    width: 6%;

    background: transparent;
    box-shadow: -0.8vmin 0 0 $color-bg, 0.8vmin 0 0 $color-bg;
  }
}

.tail {
  position: absolute;
  z-index: 0;
  right: 72%;
  bottom: 0;

  height: 6%;
  width: 15%;

  background: $color-dark;

  > .tail {
    right: 26%;

    height: 100%;
    width: 4vmin;

    transform: rotate(26deg);
    transform: rotate(0deg);
    transform-origin: center right;
    animation: tail $duration none infinite;

    border-top-left-radius: 50% 50%;
    border-bottom-left-radius: 50% 50%;
  }

  .husky > & {
    border-top-left-radius: 10% 50%;
    border-bottom-left-radius: 10% 50%;
  }

  .husky > & > & {
    right: 88%;
  }
}

@keyframes squiggly-anim {
  0% {
    filter: url('#squiggly-0');
  }
  25% {
    filter: url('#squiggly-1');
  }
  50% {
    filter: url('#squiggly-2');
  }
  75% {
    filter: url('#squiggly-3');
  }
  100% {
    filter: url('#squiggly-4');
  }
}

